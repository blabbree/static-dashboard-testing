---
title: "Example Dashboard"
output: 
  flexdashboard::flex_dashboard:
    vertical_layout: scroll
    # vertical_layout: fill
knit: (function(inputFile, encoding) { rmarkdown::render(inputFile, encoding=encoding, output_dir = "output") })
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  # cache = TRUE,
  fig.height = 5,
  echo = FALSE
)

library(crosstalk)
library(dplyr)
library(plotly)
```

```{js}
const setDefaultValue = function(filterId, defaultValue) {
  document.addEventListener("DOMContentLoaded", function(event) { 
    document.getElementById(filterId).getElementsByClassName("selectized")[0].selectize.setValue(defaultValue, false);
  });
};
```

# Overview {data-navmenu="Background"}

## Column

### Overview

Text

# Annual {data-navmenu="Time series"}

## Sidebar {.sidebar}

```{r}
yearly_totals <- readRDS("output/results/yearly_totals.rds")

shared_data <- yearly_totals %>%
  select(year, length_cat, n, mean_rating) %>%
  group_by(length_cat) %>%
  SharedData$new()
colnames <- c("Year", "Length", "Number of movies", "Mean rating")

bscols(list(
  filter_checkbox("time_series_yearly_length", "Choose runtime", shared_data, ~length_cat)
))
```
```{js}
setDefaultValue("time_series_yearly_length", ["All"]);
```

## Column

### Movies

```{r}
shared_data %>%
  plot_ly(type = "scatter", x = ~year, y = ~n,
          color = ~length_cat, name = ~length_cat,
          mode = "markers+lines", colors = unname(pals::glasbey())
  ) %>%
  layout(
    yaxis = list(title = "", fixedrange = TRUE),
    xaxis = list(title = "Projects", rangeslider = list(type = "date"))
  )
```
