---
title: "Example Dashboard"
output: 
  flexdashboard::flex_dashboard:
    vertical_layout: scroll
    # vertical_layout: fill
knit: (function(inputFile, encoding) { rmarkdown::render(inputFile, encoding=encoding, output_dir = "output") })
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  # cache = TRUE,
  fig.height = 5,
  echo = FALSE
)

library(crosstalk)
library(dplyr)
library(plotly)
```

```{js}
const setDefaultValue = function(filterId, defaultValue) {
  window.addEventListener("load", function(event) { 
    document.getElementById(filterId).getElementsByClassName("selectized")[0].selectize.setValue(defaultValue, false);
  });
};
```

# Overview

## Column

### Overview

Text

# Daily time series

## Sidebar {.sidebar}

```{r}
daily_totals <- readRDS("output/results/daily_totals.rds")

shared_data <- daily_totals %>%
  select(month_name, carrier, n) %>%
  group_by(carrier) %>%
  SharedData$new()
colnames <- c("Departure date", "Carrier", "Number of departures")

filter_select(
  "daily_time_series_carrier",
  "Choose carrier",
  shared_data,
  ~carrier,
  multiple = TRUE
)
```
```{js}
setDefaultValue("daily_time_series_carrier", "All carriers");
```

## Column

### Flights

```{r}
shared_data %>%
  plot_ly(type = "scatter", x = ~month_name, y = ~n,
          color = ~carrier, name = ~carrier,
          mode = "markers+lines", colors = unname(pals::glasbey())
  ) %>%
  layout(
    yaxis = list(title = "", fixedrange = TRUE),
    xaxis = list(title = "Departures", rangeslider = list(type = "date"))
  )
```
